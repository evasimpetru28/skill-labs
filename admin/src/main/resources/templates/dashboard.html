<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Skill Labs - Dashboard</title>

    {{>fragments/links}}
    <link rel="stylesheet" href="../static/style/navigation-style.css">
    <!-- Page style -->
    <link rel="stylesheet" href="../static/style/dashboard-style.css">
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>

<!--Main Navigation-->
<header>
    {{>fragments/sidebar}}
</header>
<!--Main Navigation-->

<!--Main layout-->
<main style="margin-top: 50px;">
    <div class="container-fluid container-custom pt-4">
        <h2>Dashboard</h2>
        <br>

        <!-- User Statistics Section -->
        <div class="section-header">
            <h4><i class="fas fa-users me-2"></i>User Statistics</h4>
        </div>
        <div class="row mb-4">
            <div class="col-xl-2 col-sm-6 col-12 mb-4">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between px-md-1">
                            <div>
                                <h3 class="text-primary" id="totalUsers">0</h3>
                                <p class="mb-0">Total Users</p>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-users text-primary fa-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-2 col-sm-6 col-12 mb-4">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between px-md-1">
                            <div>
                                <h3 class="text-success" id="studentCount">0</h3>
                                <p class="mb-0">Students</p>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-user-graduate text-success fa-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-2 col-sm-6 col-12 mb-4">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between px-md-1">
                            <div>
                                <h3 class="text-info" id="professorCount">0</h3>
                                <p class="mb-0">Professors</p>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-chalkboard-teacher text-info fa-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-2 col-sm-6 col-12 mb-4">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between px-md-1">
                            <div>
                                <h3 class="text-warning" id="companyCount">0</h3>
                                <p class="mb-0">Companies</p>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-building text-warning fa-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-2 col-sm-6 col-12 mb-4">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between px-md-1">
                            <div>
                                <h3 class="text-danger" id="adminCount">0</h3>
                                <p class="mb-0">Admins</p>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-user-shield text-danger fa-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Skills and Categories Section -->
        <div class="section-header">
            <h4><i class="fas fa-chart-bar me-2"></i>Skills & Categories</h4>
        </div>
        <div class="row mb-4">
            <div class="col-xl-3 col-sm-6 col-12 mb-4">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between px-md-1">
                            <div>
                                <h3 class="text-success" id="totalSkills">0</h3>
                                <p class="mb-0">Total Skills</p>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-chart-bar text-success fa-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-sm-6 col-12 mb-4">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between px-md-1">
                            <div>
                                <h3 class="text-warning" id="totalCategories">0</h3>
                                <p class="mb-0">Skill Categories</p>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-folder text-warning fa-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Evaluation Statistics Section -->
        <div class="section-header">
            <h4><i class="fas fa-check-circle me-2"></i>Evaluation Statistics</h4>
        </div>
        <div class="row mb-4">
            <div class="col-xl-3 col-sm-6 col-12 mb-4">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between px-md-1">
                            <div>
                                <h3 class="text-info" id="totalEvaluations">0</h3>
                                <p class="mb-0">Total Evaluations</p>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-check-circle text-info fa-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-sm-6 col-12 mb-4">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between px-md-1">
                            <div>
                                <h3 class="text-success" id="studentsWithEvals">0</h3>
                                <p class="mb-0">Students with Evaluations</p>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-user-check text-success fa-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-sm-6 col-12 mb-4">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between px-md-1">
                            <div>
                                <h3 class="text-warning" id="studentsWithoutEvals">0</h3>
                                <p class="mb-0">Students without Evaluations</p>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-user-times text-warning fa-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-sm-6 col-12 mb-4">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between px-md-1">
                            <div>
                                <h3 class="text-primary" id="avgEvaluationsPerStudent">0</h3>
                                <p class="mb-0">Avg. Evaluations per Student</p>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-chart-line text-primary fa-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="section-header">
            <h4><i class="fas fa-chart-pie me-2"></i>Analytics</h4>
        </div>
        <div class="row">
            <div class="col-xl-4 col-md-12 mb-4">
                <div class="card chart-card">
                    <div class="card-body">
                        <div id="userDistributionContainer">
                            <canvas id="userDistributionChart"></canvas>
                            <div id="noUserDistributionMessage" class="text-center d-none">
                                <i class="fas fa-users fa-3x mb-3 text-muted"></i>
                                <p class="text-muted">Only one type of user present.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-4 col-md-12 mb-4">
                <div class="card chart-card">
                    <div class="card-body">
                        <div id="skillsByCategoryContainer">
                            <canvas id="skillsByCategoryChart"></canvas>
                            <div id="noSkillsMessage" class="text-center d-none">
                                <i class="fas fa-folder fa-3x mb-3 text-muted"></i>
                                <p class="text-muted">No skills available yet.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-4 col-md-12 mb-4">
                <div class="card chart-card">
                    <div class="card-body">
                        <div id="popularSkillsContainer">
                            <canvas id="popularSkillsChart"></canvas>
                            <div id="noEvaluationsMessage" class="text-center d-none">
                                <i class="fas fa-chart-bar fa-3x mb-3 text-muted"></i>
                                <p class="text-muted">No skill evaluations available yet.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<!--Main layout-->

<script type="text/javascript" src="../static/js/dashboard.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        try {
            console.log('Fetching dashboard data...');
            
            fetch('/api/dashboard/stats')
                .then(response => response.json())
                .then(data => {
                    console.log('Data received:', data);
                    
                    // Update statistics
                    const { userStats, skillStats, evaluationStats } = data;
                    
                    // Update user statistics
                    document.getElementById('totalUsers').textContent = userStats.totalUsers || 0;
                    document.getElementById('studentCount').textContent = userStats.studentCount || 0;
                    document.getElementById('professorCount').textContent = userStats.professorCount || 0;
                    document.getElementById('companyCount').textContent = userStats.companyCount || 0;
                    document.getElementById('adminCount').textContent = userStats.adminCount || 0;
                    
                    // Update skill statistics
                    document.getElementById('totalSkills').textContent = skillStats.totalSkills || 0;
                    document.getElementById('totalCategories').textContent = skillStats.totalCategories || 0;
                    
                    // Update evaluation statistics
                    document.getElementById('totalEvaluations').textContent = evaluationStats.totalEvaluations || 0;
                    document.getElementById('studentsWithEvals').textContent = evaluationStats.studentsWithEvals || 0;
                    document.getElementById('studentsWithoutEvals').textContent = evaluationStats.studentsWithoutEvals || 0;
                    document.getElementById('avgEvaluationsPerStudent').textContent = evaluationStats.avgEvaluationsPerStudent || 0;
                    
                    // Initialize charts
                    initializeCharts(userStats, skillStats, evaluationStats);
                    console.log('Charts initialized successfully');
                })
                .catch(error => {
                    console.error('Error fetching dashboard data:', error);
                });
        } catch (error) {
            console.error('Error initializing charts:', error);
        }
    });
</script>
</body>
</html>